<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Playback Test</title>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const buffers = [];

            // Function to play a list of mp3 files directly
            function playDirect() {
                const files = ['numberFiles/1.mp3', 'numberFiles/plus.mp3', 'numberFiles/2.mp3'];
                let index = 0;

                function playNext() {
                    if (index < files.length) {
                        const audio = new Audio(files[index]);
                        audio.onended = playNext;
                        audio.play();
                        index++;
                    }
                }

                playNext();
            }

            // Function to play audio from preloaded buffers
            function playFromBuffer() {
                console.log('playFromBuffer called');
                function playBuffer(index) {
                    if (index < buffers.length) {
                        const source = audioContext.createBufferSource();
                        source.buffer = buffers[index];
                        source.connect(audioContext.destination);
                        source.onended = function() {
                            playBuffer(index + 1);
                        };
                        source.start(0);
                    }
                }

                playBuffer(0);
            }

            // Preload audio buffers
            const files = ['numberFiles/1.mp3', 'numberFiles/plus.mp3', 'numberFiles/2.mp3'];
            let loadCount = 0;

            files.forEach(function(url, index) {
                fetch(url)
                    .then(response => response.arrayBuffer())
                    .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
                    .then(audioBuffer => {
                        buffers[index] = audioBuffer;
                        loadCount++;
                        console.log(`Loaded ${url}`);
                        if (loadCount === files.length) {
                            console.log('All buffers loaded');
                            document.getElementById('playBuffer').disabled = false;
                        }
                    });
            });

            // Assign event listeners to buttons
            document.getElementById('playDirect').addEventListener('click', playDirect);
            document.getElementById('playBuffer').addEventListener('click', playFromBuffer);
        });
    </script>
</head>
<body>
    <h1>Sound Playback Test</h1>
    <button id="playDirect">Play Directly</button>
    <button id="playBuffer" disabled>Play from Buffer</button>
</body>
</html>
